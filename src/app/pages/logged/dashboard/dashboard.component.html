<!-- Header Component -->
<app-header></app-header>

<!-- Main Dashboard Content -->
<main class="dashboard-main">
  <div class="container-fluid">

    <!-- Page Header -->
    <div class="dashboard-header mb-4">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="page-title">
            <i class="fas fa-chart-line me-3"></i>
            Dashboard - Setor de TI
          </h1>
          <p class="page-subtitle">
            Acompanhamento em tempo real dos atendimentos e performance da equipe
          </p>
        </div>
        <div class="col-md-4 text-md-end">
          <div class="header-actions">
            <button class="btn btn-outline-secondary me-2" (click)="refreshData()">
              <i class="fas fa-sync-alt me-1"></i>
              Atualizar
            </button>
            <button class="btn btn-primary" (click)="exportReport()">
              <i class="fas fa-file-export me-1"></i>
              Exportar
            </button>
          </div>
        </div>
      </div>
      <small class="last-update">
        <i class="fas fa-clock me-1"></i>
        Última atualização: {{ lastUpdate | date:'dd/MM/yyyy HH:mm:ss' }}
      </small>
    </div>

    <!-- Métricas Principais -->
    <div class="row metrics-row mb-4">
      <!-- Total Geral -->
      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="metric-card metric-primary">
          <div class="metric-icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ metricas.totalChamados }}</h3>
            <p class="metric-label">Total de Chamados</p>
            <small class="metric-change positive">
              <i class="fas fa-arrow-up"></i>
              +{{ metricas.crescimentoTotal }}% este mês
            </small>
          </div>
        </div>
      </div>

      <!-- Chamados Hoje -->
      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="metric-card metric-info">
          <div class="metric-icon">
            <i class="fas fa-calendar-day"></i>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ metricas.chamadosHoje }}</h3>
            <p class="metric-label">Chamados Hoje</p>
            <small class="metric-change">
              <i class="fas fa-calendar"></i>
              {{ metricas.mediaDiaria }} por dia (média)
            </small>
          </div>
        </div>
      </div>

      <!-- Tempo Médio -->
      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="metric-card metric-warning">
          <div class="metric-icon">
            <i class="fas fa-stopwatch"></i>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ metricas.tempoMedio }}h</h3>
            <p class="metric-label">Tempo Médio</p>
            <small class="metric-change negative">
              <i class="fas fa-arrow-down"></i>
              -15% vs. semana passada
            </small>
          </div>
        </div>
      </div>

      <!-- Taxa de Resolução -->
      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="metric-card metric-success">
          <div class="metric-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ metricas.taxaResolucao }}%</h3>
            <p class="metric-label">Taxa de Resolução</p>
            <small class="metric-change positive">
              <i class="fas fa-arrow-up"></i>
              +5% vs. mês passado
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance por Período -->
    <div class="row mb-4">
      <div class="col-lg-8">
        <div class="card dashboard-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-chart-bar me-2"></i>
              Atendimentos por Período
            </h5>
            <div class="card-actions">
              <select class="form-select form-select-sm" [(ngModel)]="periodoSelecionado" (change)="atualizarPeriodo()">
                <option value="hoje">Hoje</option>
                <option value="semana">Esta Semana</option>
                <option value="mes">Este Mês</option>
                <option value="ano">Este Ano</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="period-metrics">
              <div class="row text-center">
                <div class="col-3">
                  <div class="period-stat">
                    <h4 class="period-number text-primary">{{ atendimentosPeriodo.hoje }}</h4>
                    <p class="period-label">Hoje</p>
                  </div>
                </div>
                <div class="col-3">
                  <div class="period-stat">
                    <h4 class="period-number text-info">{{ atendimentosPeriodo.semana }}</h4>
                    <p class="period-label">Esta Semana</p>
                  </div>
                </div>
                <div class="col-3">
                  <div class="period-stat">
                    <h4 class="period-number text-warning">{{ atendimentosPeriodo.mes }}</h4>
                    <p class="period-label">Este Mês</p>
                  </div>
                </div>
                <div class="col-3">
                  <div class="period-stat">
                    <h4 class="period-number text-success">{{ atendimentosPeriodo.ano }}</h4>
                    <p class="period-label">Este Ano</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status dos Chamados -->
      <div class="col-lg-4">
        <div class="card dashboard-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-flag me-2"></i>
              Status Atual
            </h5>
          </div>
          <div class="card-body">
            <div class="status-list">
              <div class="status-item" *ngFor="let status of statusChamados">
                <div class="status-info">
                  <span class="status-badge" [ngClass]="'badge-' + status.classe">
                    {{ status.nome }}
                  </span>
                  <span class="status-count">{{ status.quantidade }}</span>
                </div>
                <div class="status-progress">
                  <div class="progress">
                    <div class="progress-bar" [ngClass]="'bg-' + status.classe"
                         [style.width.%]="status.porcentagem">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance por Técnico -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card dashboard-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-users me-2"></i>
              Performance dos Técnicos
            </h5>
            <div class="card-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="togglePeriodoTecnico()">
                {{ mostrarPeriodoTecnico === 'dia' ? 'Semana' : mostrarPeriodoTecnico === 'semana' ? 'Mês' : 'Dia' }}
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Técnico</th>
                    <th class="text-center">Hoje</th>
                    <th class="text-center">Esta Semana</th>
                    <th class="text-center">Este Mês</th>
                    <th class="text-center">Tempo Médio</th>
                    <th class="text-center">Taxa Resolução</th>
                    <th class="text-center">Avaliação</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let tecnico of performanceTecnicos" class="tecnico-row">
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="tech-avatar-small me-2">
                          {{ tecnico.nome.charAt(0).toUpperCase() }}
                        </div>
                        <div>
                          <div class="fw-medium">{{ tecnico.nome }}</div>
                          <small class="text-muted">{{ tecnico.especializacao }}</small>
                        </div>
                      </div>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-primary">{{ tecnico.atendimentosHoje }}</span>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-info">{{ tecnico.atendimentosSemana }}</span>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-warning">{{ tecnico.atendimentosMes }}</span>
                    </td>
                    <td class="text-center">
                      <span class="tempo-medio">{{ tecnico.tempoMedio }}h</span>
                    </td>
                    <td class="text-center">
                      <span class="taxa-resolucao" [ngClass]="getTaxaClass(tecnico.taxaResolucao)">
                        {{ tecnico.taxaResolucao }}%
                      </span>
                    </td>
                    <td class="text-center">
                      <div class="avaliacao">
                        <i class="fas fa-star" [ngClass]="{'text-warning': i < tecnico.avaliacao, 'text-muted': i >= tecnico.avaliacao}"
                           *ngFor="let star of [1,2,3,4,5]; let i = index"></i>
                        <small class="d-block text-muted">{{ tecnico.avaliacao }}/5</small>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Widgets Adicionais -->
    <div class="row mb-4">
      <!-- Prioridades -->
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card dashboard-card widget-card">
          <div class="card-header">
            <h6 class="card-title">
              <i class="fas fa-exclamation-triangle me-2"></i>
              Por Prioridade
            </h6>
          </div>
          <div class="card-body">
            <div class="priority-list">
              <div class="priority-item" *ngFor="let prioridade of prioridades">
                <div class="priority-info">
                  <span class="priority-badge" [ngClass]="'badge-' + prioridade.classe">
                    <i class="fas" [ngClass]="prioridade.icone"></i>
                    {{ prioridade.nome }}
                  </span>
                  <span class="priority-count">{{ prioridade.quantidade }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Categorias -->
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card dashboard-card widget-card">
          <div class="card-header">
            <h6 class="card-title">
              <i class="fas fa-tags me-2"></i>
              Por Categoria
            </h6>
          </div>
          <div class="card-body">
            <div class="category-list">
              <div class="category-item" *ngFor="let categoria of categorias">
                <div class="category-info">
                  <i class="fas" [ngClass]="categoria.icone"></i>
                  <span class="category-name">{{ categoria.nome }}</span>
                  <span class="category-count">{{ categoria.quantidade }}</span>
                </div>
                <div class="category-progress">
                  <div class="progress progress-sm">
                    <div class="progress-bar bg-primary" [style.width.%]="categoria.porcentagem"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SLA e Metas -->
      <div class="col-lg-4 col-md-12 mb-3">
        <div class="card dashboard-card widget-card">
          <div class="card-header">
            <h6 class="card-title">
              <i class="fas fa-target me-2"></i>
              SLA e Metas
            </h6>
          </div>
          <div class="card-body">
            <div class="sla-metrics">
              <div class="sla-item">
                <div class="sla-label">Tempo Resposta SLA</div>
                <div class="sla-value">
                  <div class="progress">
                    <div class="progress-bar bg-success" style="width: 87%"></div>
                  </div>
                  <small class="text-success">87% dentro do SLA</small>
                </div>
              </div>
              <div class="sla-item">
                <div class="sla-label">Meta Mensal</div>
                <div class="sla-value">
                  <div class="progress">
                    <div class="progress-bar bg-info" style="width: 72%"></div>
                  </div>
                  <small class="text-info">72% da meta alcançada</small>
                </div>
              </div>
              <div class="sla-item">
                <div class="sla-label">Satisfação Cliente</div>
                <div class="sla-value">
                  <div class="progress">
                    <div class="progress-bar bg-warning" style="width: 94%"></div>
                  </div>
                  <small class="text-warning">4.7/5.0 estrelas</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chamados Recentes -->
    <div class="row">
      <div class="col-12">
        <div class="card dashboard-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-clock me-2"></i>
              Chamados Recentes
            </h5>
            <div class="card-actions">
              <a href="/todos-chamados" class="btn btn-sm btn-outline-primary">
                Ver Todos
                <i class="fas fa-arrow-right ms-1"></i>
              </a>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover table-sm">
                <thead>
                  <tr>
                    <th>Nº Chamado</th>
                    <th>Solicitante</th>
                    <th>Problema</th>
                    <th>Técnico</th>
                    <th>Status</th>
                    <th>Há</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let chamado of chamadosRecentes">
                    <td class="fw-bold">#{{ chamado.numero }}</td>
                    <td>{{ chamado.solicitante }}</td>
                    <td>
                      <div class="problema-desc">{{ chamado.problema }}</div>
                    </td>
                    <td>
                      <span class="badge bg-secondary" *ngIf="chamado.tecnico">
                        {{ chamado.tecnico }}
                      </span>
                      <span class="text-muted" *ngIf="!chamado.tecnico">Não atribuído</span>
                    </td>
                    <td>
                      <span class="status-badge" [ngClass]="getStatusClass(chamado.status)">
                        {{ chamado.status }}
                      </span>
                    </td>
                    <td>
                      <small class="text-muted">{{ chamado.tempoDecorrido }}</small>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>
